
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="baidu-site-verification" content="code-o47qQmYL2s" />
    <title>基于MVVM构建聊天App （二）登录UI实现 - 小时光のホームページ</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="iOS,Swift,xiaoshiguang,"> 
    <meta name="description" content="小时光

1、一个完整的开发流程一般的，一个正常的流程包括：

产品定需求，给出原型图
团队确认需求
由设计师开始设计图，同步开发做开发前的准备工作，如技术调查，前后端如何配合等
设计师完成设计后，,"> 
    <meta name="author" content="小时光"> 
    <link rel="alternative" href="atom.xml" title="小时光のホームページ" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">小时光のホームページ</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://dengfeng520.github.io"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">基于MVVM构建聊天App （二）登录UI实现</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">基于MVVM构建聊天App （二）登录UI实现</h1>
        <div class="stuff">
            <span>一月 05, 2021</span>
            

        </div>
        <div class="content markdown">
            <h6 align='right'>小时光</h6>

<h3 id="1、一个完整的开发流程"><a href="#1、一个完整的开发流程" class="headerlink" title="1、一个完整的开发流程"></a>1、一个完整的开发流程</h3><p>一般的，一个正常的流程包括：</p>
<ul>
<li>产品定需求，给出原型图</li>
<li>团队确认需求</li>
<li>由设计师开始设计图，同步开发做开发前的准备工作，如技术调查，前后端如何配合等</li>
<li>设计师完成设计后，团队对比设计图和原型图再次确认需求</li>
<li>开发团队开始开发工作</li>
<li>开发完成后由开发者自测 一般我们在开发中编写的单元测试代码也属于自测</li>
<li>开发者自测后由产品测试，事实上在开发过程中，产品也应该实时的关注开发</li>
<li>交由专业测试人员做测试</li>
<li>发布内测版本，做大规模测试</li>
<li>提交App Store审核</li>
</ul>
<h3 id="2、storyboard的App启动过程"><a href="#2、storyboard的App启动过程" class="headerlink" title="2、storyboard的App启动过程"></a>2、storyboard的App启动过程</h3><p><strong>UIApplicationMain</strong></p>
<p>一般的如果新建了一个<code>Objective-C</code>工程，默认先<code>main</code>函数，<code>main</code>函数内部会调用<code>UIApplicationMain</code>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但在<code>Swift</code>项目中，并没有<code>main.m</code>文件也没有<code>main</code>函数。<code>Swift</code>工程是在<code>AppDelegate</code>中用一个<code>@UIApplicationMain</code>标签。那么<code>UIApplicationMain</code>做了哪些操作呢：</p>
<ul>
<li><p>创建<code>UIApplication</code>单例对象</p>
</li>
<li><p>创建<code>UIApplication</code>的委托对象，即<code>AppDelegate</code></p>
</li>
<li><p>开启事件循环监听系统事件，当坚挺到对应的系统事件时会通知<code>AppDelegate</code></p>
</li>
<li><p>创建最底层的<code>UIWindows</code>对象，</p>
</li>
<li><p>读取<code>Info.plist</code>中设置的默认启动<code>storyboard</code>文件名称</p>
</li>
<li><p>加载设置的<code>is Initial View Controller</code><strong>storyboard</strong>文件，同时创建对应的<code>View Controller</code>对象</p>
</li>
<li><p>设置创建的<code>View Controller</code>为<code>UIWindows</code>的根视图<code>rootViewController</code></p>
</li>
<li><p>显示<code>Windows</code>上的试图</p>
<p>运行工程可以看到如下图： 最底层是一个<strong>UIWindwos</strong></p>
</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2020/6/28/172fa5dc09551fd3?w=919&h=828&f=png&s=431032" alt="windows"></p>
<h3 id="3、没有storyboard的启动"><a href="#3、没有storyboard的启动" class="headerlink" title="3、没有storyboard的启动"></a>3、没有storyboard的启动</h3><p> 一般的一个工程，默认从<code>main.storyboard</code>中的设置的<code>Initial view controller</code>启动的，那么我们该如何设置自己的初始启动<code>View Controller</code>呢？</p>
<p>在前面我们工程的结构：<strong>RPChat_iOS</strong>文件夹下是UI显示以及交互相关的代码，所以在<strong>RPChat_iOS</strong>中新建一个<strong>SignIn文件夹</strong>该目录下为登录相关的UI代码：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/1/173095ed9d6b11e0?w=202&h=386&f=png&s=121214" alt="SignIn"></p>
<p>新建登陆界面<code>Controller</code>命名为<code>SignInViewController</code></p>
<p>在<strong>AppDelegate</strong><code>didFinishLaunchingWithOptions launchOptions</code>回调方法中添加代码，设置SignInViewController为默认启动控制器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if #available(iOS 13, *) &#123;</span><br><span class="line">    </span><br><span class="line">&#125; else &#123;</span><br><span class="line">     window &#x3D; UIWindow.init()</span><br><span class="line">     window?.frame &#x3D; UIScreen.main.bounds</span><br><span class="line">     window?.makeKeyAndVisible()</span><br><span class="line">     let signInVC &#x3D; SignInViewController()</span><br><span class="line">     window?.rootViewController &#x3D; signInVC</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<strong>SceneDelegate</strong><code>options connectionOptions</code>方法中添加代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">guard let windowScene &#x3D; (scene as? UIWindowScene) else &#123; return &#125;</span><br><span class="line"></span><br><span class="line">window &#x3D; UIWindow(frame: windowScene.coordinateSpace.bounds)</span><br><span class="line">window?.windowScene &#x3D; windowScene</span><br><span class="line">window?.backgroundColor &#x3D; .white</span><br><span class="line">let tabBar &#x3D; SignInViewController()</span><br><span class="line">window?.rootViewController &#x3D; tabBar</span><br><span class="line">window?.makeKeyAndVisible()</span><br></pre></td></tr></table></figure>

<h3 id="4、登录UI的实现"><a href="#4、登录UI的实现" class="headerlink" title="4、登录UI的实现"></a>4、登录UI的实现</h3><p>先看一下这是最终效果图：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/1/1730924e872c0e71?w=1242&h=2688&f=png&s=130841" alt="light Mode"></p>
<h5 id="4-1、Auto-Layout"><a href="#4-1、Auto-Layout" class="headerlink" title="4.1、Auto Layout"></a>4.1、<code>Auto Layout</code></h5><p>至于UI，考虑到版本兼容和后期维护我采用了系统<code>NSLayoutAnchor</code>适配，</p>
<p><code>NSLayoutAnchor</code>常用属性</p>
<ul>
<li>leadingAnchor</li>
<li>trailingAnchor</li>
<li>leftAnchor</li>
<li>rightAnchor</li>
<li>topAnchor</li>
<li>bottomAnchor</li>
<li>widthAnchor</li>
<li>heightAnchor</li>
<li>centerXAnchor</li>
<li>centerYAnchor</li>
<li>firstBaselineAnchor</li>
<li>lastBaselineAnchor</li>
</ul>
<p>关于<code>Auto Layout</code>其他更多使用细节请参考官方文档:</p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2018/202/">High Performance Auto Layout</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/nslayoutconstraint">Apple Develope NSLayoutConstraint</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/nslayoutanchor">Apple Develope NSLayoutAnchor</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2018/202/">WWDC 2018 What’s New in Cocoa Touch</a></p>
<h5 id="4-2、UI实现"><a href="#4-2、UI实现" class="headerlink" title="4.2、UI实现"></a>4.2、UI实现</h5><p>新建一个<code>View</code>命名<code>SignInRootView</code>作为登录界面的主<code>View</code>，采用懒加载的方式初始化视图</p>
<p>最顶部的<code>Logo</code>图片实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lazy var logoImg: UIImageView &#x3D; &#123;</span><br><span class="line">        self.addSubview($0)</span><br><span class="line">        $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">        let top &#x3D; $0.topAnchor.constraint(equalTo: self.safeAreaLayoutGuide.topAnchor, constant: 44)</span><br><span class="line">        let centerX &#x3D; $0.centerXAnchor.constraint(equalTo: self.centerXAnchor, constant: 0)</span><br><span class="line">        let width &#x3D; $0.widthAnchor.constraint(equalToConstant: 120)</span><br><span class="line">        let height &#x3D; $0.heightAnchor.constraint(equalToConstant: 120)</span><br><span class="line">        NSLayoutConstraint.activate([top, centerX, width, height])</span><br><span class="line">        return $0</span><br><span class="line">    &#125;(UIImageView())</span><br></pre></td></tr></table></figure>
<p>用户名输入框实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">lazy var accountNumberView: UIView &#x3D; &#123;</span><br><span class="line">       self.addSubview($0)</span><br><span class="line">       $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">       let top &#x3D; $0.topAnchor.constraint(equalTo: logoImg.bottomAnchor, constant: 20)</span><br><span class="line">       let left &#x3D; $0.leftAnchor.constraint(equalTo: self.leftAnchor, constant: 40)</span><br><span class="line">       let right &#x3D; $0.rightAnchor.constraint(equalTo: self.rightAnchor, constant: -40)</span><br><span class="line">       let height &#x3D; $0.heightAnchor.constraint(equalToConstant: 50)</span><br><span class="line">       NSLayoutConstraint.activate([top, left, right, height])</span><br><span class="line">       $0.layer.cornerRadius &#x3D; 25</span><br><span class="line">       return $0</span><br><span class="line">   &#125;(UIView())</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   lazy var accountNumberLab: UITextField &#x3D; &#123;</span><br><span class="line">       accountNumberView.addSubview($0)</span><br><span class="line">       $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">       $0.topAnchor.constraint(equalTo: accountNumberView.topAnchor, constant: 0).isActive &#x3D; true</span><br><span class="line">       $0.leftAnchor.constraint(equalTo: accountNumberView.leftAnchor, constant: 16).isActive &#x3D; true</span><br><span class="line">       $0.rightAnchor.constraint(equalTo: accountNumberView.rightAnchor, constant: -16).isActive &#x3D; true</span><br><span class="line">       $0.bottomAnchor.constraint(equalTo: accountNumberView.bottomAnchor, constant: 0).isActive &#x3D; true</span><br><span class="line">       $0.font &#x3D; UIFont.init(name: &quot;PingFangTC-Semibold&quot;, size: 19)</span><br><span class="line">       return $0</span><br><span class="line">   &#125;(UITextField())</span><br></pre></td></tr></table></figure>
<p>密码输入框实现代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">lazy var inputPasswordView: UIView &#x3D; &#123;</span><br><span class="line">           self.addSubview($0)</span><br><span class="line">           $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">           let top &#x3D; $0.topAnchor.constraint(equalTo: accountNumberView.bottomAnchor, constant: 20)</span><br><span class="line">           let left &#x3D; $0.leftAnchor.constraint(equalTo: self.leftAnchor, constant: 40)</span><br><span class="line">           let right &#x3D; $0.rightAnchor.constraint(equalTo: self.rightAnchor, constant: -40)</span><br><span class="line">           let height &#x3D; $0.heightAnchor.constraint(equalToConstant: 50)</span><br><span class="line">           NSLayoutConstraint.activate([top, left, right, height])</span><br><span class="line">           $0.layer.cornerRadius &#x3D; 25</span><br><span class="line">           return $0</span><br><span class="line">       &#125;(UIView())</span><br><span class="line">    </span><br><span class="line">       </span><br><span class="line">    lazy var inputPasswordTxt: UITextField &#x3D; &#123;</span><br><span class="line">           inputPasswordView.addSubview($0)</span><br><span class="line">           $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">           $0.topAnchor.constraint(equalTo: inputPasswordView.topAnchor, constant: 0).isActive &#x3D; true</span><br><span class="line">           $0.leftAnchor.constraint(equalTo: inputPasswordView.leftAnchor, constant: 16).isActive &#x3D; true</span><br><span class="line">           $0.rightAnchor.constraint(equalTo: inputPasswordView.rightAnchor, constant: -16).isActive &#x3D; true</span><br><span class="line">           $0.bottomAnchor.constraint(equalTo: inputPasswordView.bottomAnchor, constant: 0).isActive &#x3D; true</span><br><span class="line">           $0.font &#x3D; UIFont.init(name: &quot;PingFangTC-Semibold&quot;, size: 19)</span><br><span class="line">           return $0</span><br><span class="line">       &#125;(UITextField())</span><br></pre></td></tr></table></figure>
<p>登录按钮实现代码： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lazy var signInBtn: UIButton &#x3D; &#123;</span><br><span class="line">        self.addSubview($0)</span><br><span class="line">        $0.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">        let top &#x3D; $0.topAnchor.constraint(equalTo: inputPasswordView.bottomAnchor, constant: 20)</span><br><span class="line">        let left &#x3D; $0.leftAnchor.constraint(equalTo: self.leftAnchor, constant: 40)</span><br><span class="line">        let right &#x3D; $0.rightAnchor.constraint(equalTo: self.rightAnchor, constant: -40)</span><br><span class="line">        let height &#x3D; $0.heightAnchor.constraint(equalToConstant: 50)</span><br><span class="line">        NSLayoutConstraint.activate([top, left, right, height])</span><br><span class="line">        $0.layer.cornerRadius &#x3D; 25</span><br><span class="line">        $0.titleLabel?.font &#x3D; UIFont.init(name: &quot;PingFangTC-Semibold&quot;, size: 20)</span><br><span class="line">        $0.setTitle(NSLocalizedString(&quot;Sign In&quot;, comment: &quot;&quot;), for: .normal)</span><br><span class="line">        return $0</span><br><span class="line">   &#125;(UIButton())</span><br></pre></td></tr></table></figure>
<p>此处代码较多，具体实现请看代码： <a target="_blank" rel="noopener" href="https://github.com/dengfeng520/RPChat">gitub RPChat</a></p>
<h5 id="4-3、设置背景颜色"><a href="#4-3、设置背景颜色" class="headerlink" title="4.3、设置背景颜色"></a>4.3、设置背景颜色</h5><p>由于设计师给出的颜色一般为16进制，此处需要做一个转码处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class func hexStringToColor(_ hexadecimal: String) -&gt; UIColor &#123;</span><br><span class="line">        var cstr &#x3D; hexadecimal.trimmingCharacters(in:  CharacterSet.whitespacesAndNewlines).uppercased() as NSString;</span><br><span class="line">        if(cstr.length &lt; 6)&#123;</span><br><span class="line">            return UIColor.clear;</span><br><span class="line">        &#125;</span><br><span class="line">        if(cstr.hasPrefix(&quot;0X&quot;))&#123;</span><br><span class="line">            cstr &#x3D; cstr.substring(from: 2) as NSString</span><br><span class="line">        &#125;</span><br><span class="line">        if(cstr.hasPrefix(&quot;#&quot;))&#123;</span><br><span class="line">            cstr &#x3D; cstr.substring(from: 1) as NSString</span><br><span class="line">        &#125;</span><br><span class="line">        if(cstr.length !&#x3D; 6)&#123;</span><br><span class="line">            return UIColor.clear;</span><br><span class="line">        &#125;</span><br><span class="line">        var range &#x3D; NSRange.init()</span><br><span class="line">        range.location &#x3D; 0</span><br><span class="line">        range.length &#x3D; 2</span><br><span class="line">        let rStr &#x3D; cstr.substring(with: range);</span><br><span class="line">        range.location &#x3D; 2;</span><br><span class="line">        let gStr &#x3D; cstr.substring(with: range)</span><br><span class="line">        range.location &#x3D; 4;</span><br><span class="line">        let bStr &#x3D; cstr.substring(with: range)</span><br><span class="line">        var r :UInt32 &#x3D; 0x0;</span><br><span class="line">        var g :UInt32 &#x3D; 0x0;</span><br><span class="line">        var b :UInt32 &#x3D; 0x0;</span><br><span class="line">        Scanner.init(string: rStr).scanHexInt32(&amp;r);</span><br><span class="line">        Scanner.init(string: gStr).scanHexInt32(&amp;g);</span><br><span class="line">        Scanner.init(string: bStr).scanHexInt32(&amp;b);</span><br><span class="line">        return UIColor.init(red: CGFloat(r)&#x2F;255.0, green: CGFloat(g)&#x2F;255.0, blue: CGFloat(b)&#x2F;255.0, alpha: 1)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>然后就可以用设计师给的16进制设置背景颜色：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signInBtn.backgroundColor &#x3D; UIColor.hexStringToColor(&quot;0xF5BE62&quot;)</span><br></pre></td></tr></table></figure>
<h5 id="4-4、Drak-Mode适配"><a href="#4-4、Drak-Mode适配" class="headerlink" title="4.4、Drak Mode适配"></a>4.4、Drak Mode适配</h5><h6 id="4-4-1、文本和UIView背景颜色适配"><a href="#4-4-1、文本和UIView背景颜色适配" class="headerlink" title="4.4.1、文本和UIView背景颜色适配"></a>4.4.1、文本和UIView背景颜色适配</h6><p>由于<code>iOS 13</code>之后苹果处理<code>Drak Mode</code>,作为开发者也应该做相应的兼容处理。现在我在代码中并没有此时调整模拟器为暗模式，运行工程可以看到在暗模式下，用户名和密码输入框背景色不见了。此时就应该做暗模式的兼容处理。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/1/1730940682f94d7e?w=1242&h=2688&f=png&s=128055" alt="drak mode"></p>
<p>此处我的做法也很简单，对<code>UIColor</code>做<code>extension</code>处理，然后再扩展方法中分别对<code>Drak Mode</code>和<code>Light Mode</code>两种模式做对应的处理，代码如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">extension UIColor &#123;</span><br><span class="line">   &#x2F;&#x2F;&#x2F; 当前是否是暗模式</span><br><span class="line">    public class var drakMode: Bool &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            let currentMode &#x3D; UITraitCollection.current.userInterfaceStyle</span><br><span class="line">            if currentMode &#x3D;&#x3D; .dark &#123;</span><br><span class="line">                return true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line">    public class func isDrakMode() -&gt; Bool &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            let currentMode &#x3D; UITraitCollection.current.userInterfaceStyle</span><br><span class="line">            if currentMode &#x3D;&#x3D; .dark &#123;</span><br><span class="line">                return true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; UIView背景颜色</span><br><span class="line">    public class var darkModeViewColor: UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            return .systemBackground</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .white</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class func configDarkModeViewColor() -&gt; UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            return .systemBackground</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .white</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 文字颜色</span><br><span class="line">    public class var darkModeTextColor: UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return .white</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return .black</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .black</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class func configDarkModeTxtColor() -&gt; UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return .white</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return .black</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .black</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 子UIView背景颜色</span><br><span class="line">    public class var subDarkModeViewColor: UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return UIColor(red: 100&#x2F;255, green: 100&#x2F;255, blue: 100&#x2F;255, alpha: 1)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return .groupTableViewBackground</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .groupTableViewBackground</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class func configSubDarkModeViewColor() -&gt; UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return UIColor(red: 100&#x2F;255, green: 100&#x2F;255, blue: 100&#x2F;255, alpha: 1)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return .groupTableViewBackground</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return .groupTableViewBackground</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; 设置Placeholder文字颜色</span><br><span class="line">    public class var placeholderColor: UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return UIColor(red: 255, green: 255, blue: 255, alpha: 0.25)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return UIColor(red: 0, green: 0, blue: 0, alpha: 0.25)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return UIColor(red: 0, green: 0, blue: 0, alpha: 0.25)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class func configPlaceholderColor() -&gt; UIColor &#123;</span><br><span class="line">        if #available(iOS 13.0, *) &#123;</span><br><span class="line">            if drakMode &#x3D;&#x3D; true &#123;</span><br><span class="line">                return UIColor(red: 255, green: 255, blue: 255, alpha: 0.25)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return UIColor(red: 0, green: 0, blue: 0, alpha: 0.25)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return UIColor(red: 0, green: 0, blue: 0, alpha: 0.25)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需要在设置颜色时通过方法或者属性设置即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">accountNumberView.backgroundColor &#x3D; .subDarkModeViewColor</span><br><span class="line">inputPasswordView.backgroundColor &#x3D; .subDarkModeViewColor</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">accountNumberView.backgroundColor &#x3D; UIColor.configSubDarkModeViewColor()</span><br><span class="line">inputPasswordView.backgroundColor &#x3D; UIColor.configSubDarkModeViewColor()</span><br></pre></td></tr></table></figure>
<p>从结果上来说，这两种方式没有任何区别。一般用属性的话在设置或计算时看起来更自然一些，例如我用 <code>a = 0</code>会比<code>a = getData()</code> 看起来更直观自然一些。<br>《Clearn Code》一书中强调，对方法或函数的命名尽量使用动词或动词短语，所以在使用一个方法时，通常的代码表示要做一些事情。此处我只是修改<code>UIView</code>的背景颜色，所以我个人觉得使用属性设置更直观一些。</p>
<h6 id="4-4-2、图片DrakMode适配"><a href="#4-4-2、图片DrakMode适配" class="headerlink" title="4.4.2、图片DrakMode适配"></a>4.4.2、图片DrakMode适配</h6><p>在Xcode中修改图片为Any,Dark，Xcode会自动生成一组新的暗模式下的填充图片，把图片拖入即可。<br><img src="https://upload-images.jianshu.io/upload_images/1214383-e124e54aec36e840.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DrakMode"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1214383-f43ddf384b598988.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drak Mode"></p>
<h6 id="4-4-3、监听traitCollection的变化"><a href="#4-4-3、监听traitCollection的变化" class="headerlink" title="4.4.3、监听traitCollection的变化"></a>4.4.3、监听<strong>traitCollection</strong>的变化</h6><p>在一些特殊的地方需要根据当前系统是否处于暗模式分别作出处理，如一般情况下隐私协议用WKWebView加载,在正常情况下为白色背景黑色文字，在暗模式下为黑色背景白色文字，此时上面的代码已经不能满足我的需求了。此时就需要对当前系统是否是暗模式做监听处理。</p>
<p>我的做法是定一个DrakModeProtocol协议，在需要监听的Controller中，遵循这个协议即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F; 协议</span><br><span class="line">public protocol DrakModeProtocol : NSObjectProtocol &#123;</span><br><span class="line">    @available(iOS 13.0, *)</span><br><span class="line">    var traitCollection: UITraitCollection &#123; get &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    @available(iOS 13.0, *)</span><br><span class="line">    func traitCollectionDidChange(_ traitCollection: UITraitCollection?)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F; 使用方法</span><br><span class="line">extension MineWKWebViewController: DrakModeProtocol &#123;</span><br><span class="line">    override func traitCollectionDidChange(_ traitCollection: UITraitCollection?) &#123;</span><br><span class="line">           if #available(iOS 13.0, *) &#123;</span><br><span class="line">               if UITraitCollection.current.userInterfaceStyle &#x3D;&#x3D; .dark &#123;</span><br><span class="line">                   webView.evaluateJavaScript(&quot;document.body.style.backgroundColor&#x3D;\&quot;#000000\&quot;&quot;) &#123; (data, error) in</span><br><span class="line">                       </span><br><span class="line">                   &#125;</span><br><span class="line">                   webView.evaluateJavaScript(&quot;document.body.style.webkitTextFillColor&#x3D;\&quot;#FFFFFF\&quot;&quot;) &#123; (data, error) in</span><br><span class="line">                       </span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; else &#123;</span><br><span class="line">                   webView.evaluateJavaScript(&quot;document.body.style.backgroundColor&#x3D;\&quot;#FFFFFF\&quot;&quot;) &#123; (data, error) in</span><br><span class="line">                       </span><br><span class="line">                   &#125;</span><br><span class="line">                   webView.evaluateJavaScript(&quot;document.body.style.webkitTextFillColor&#x3D;\&quot;#000000\&quot;&quot;) &#123; (data, error) in</span><br><span class="line">                       </span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45758010c13f408eb0ba42166dba5b36~tplv-k3u1fbpfcp-zoom-1.image" alt="隐私协议"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef595234a7af43879feef7cb686d0f84~tplv-k3u1fbpfcp-zoom-1.image" alt="隐私协议"></p>
<p>再次运行项目，可以看到界面已经兼容了暗模式：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/1/17309250eeaae02b?w=1242&h=2688&f=png&s=132283" alt="drak Mode"></p>
<h6 id="4-4-4、iOS-13之前老版本采用微软的开源库FluentDarkModeKit"><a href="#4-4-4、iOS-13之前老版本采用微软的开源库FluentDarkModeKit" class="headerlink" title="4.4.4、iOS 13之前老版本采用微软的开源库FluentDarkModeKit"></a>4.4.4、iOS 13之前老版本采用微软的开源库<code>FluentDarkModeKit</code></h6><p> 关于<code>FluentDarkModeKit</code>使用细节请参考<a target="_blank" rel="noopener" href="https://github.com/microsoft/FluentDarkModeKit">microsoft  FluentDarkModeKit</a></p>
<p>本文主要写了： </p>
<ul>
<li>不通过storyboard启动App</li>
<li>登录UI的实现</li>
<li>Drak Mode的适配</li>
</ul>
<p>[本文demo: Github RPChat](</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/29307041.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
